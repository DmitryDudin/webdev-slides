<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Build, Deploy, Automate</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css" id="theme">
    <link rel="stylesheet" href="../lib/css/zenburn.css">
    <link rel="stylesheet" href="./css/user.css">
</head>
<body class="yandex"><div class="reveal"><div class="slides">

<section>
    <h4><del class=grey>Ешь, молись, люби</del></h4>
    <h4>Build, Deploy, Automate</h4>
    <p class="author">
        <small>Жигалов Сергей, </small> <small>Грищенко Антон, </small> <small>Гоголев Сергей</small>
    </p>
</section>

<section>
    <h4><a href="#/1">Dependencies</a></h4>
</section>

<section>
    <p class="fragment"><img src="img/npm.svg" width=200></p>
    <p class="fragment"><img src="img/bower.png" width=200></p>
</section>

<section>
    <img src="img/bower.png" width=200>
    <pre>
<span class=grey>bower_components</span>
├── backbone<span class=green>#53f7790</span>
├── moment<span class=green>#53f7790</span>
├── underscore<span class=green>#53f7790</span>
└── magnific-popup<span class=green>#53f7790</span>
  </pre>
</section>

<section>
    <img src="img/npm.svg" width=200>
    <pre>
<span class=grey>node_modules</span>
├─┬ hbs<span class=green>@4.0.0</span>
│ ├─┬ handlebars<span class=green>@4.0.3</span>
│ │ ├─┬ optimist<span class=green>@0.6.1</span>
│ │ │ ├── minimist<span class=green>@0.0.10</span>
│ │ │ └── wordwrap<span class=green>@0.0.3</span>
│ │ ├─┬ source-map<span class=green>@0.4.4</span>
│ │ │ └── amdefine<span class=green>@1.0.0</span>
│ └─┬ walk<span class=green>@2.2.1</span>
│   └─┬ forEachAsync<span class=green>@2.2.1</span>
│     └── sequence<span class=green>@2.2.1</span>
└─┬ morgan<span class=green>@1.7.0</span>
  ├── basic-auth<span class=green>@1.0.3</span>
  └── on-headers<span class=green>@1.0.1</span>
  </pre>
</section>

<section>
    <h4>npm</h4>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>init</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>search</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>show</span> express
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> express
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> <span class=magenta>--save</span> express
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> <span class=magenta>--save-dev</span> mocha
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> express@1.0.0
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>uninstall</span> express
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>list</span>
    </pre>
</section>

<section>
    <h4>npm <span class=green>install</span></h4>
    <pre class="grey">
{
  "dependencies": {
    <span class=fragment>"express": "<span class="green">1.2.3</span>",</span>
    <span class=fragment>"express": "<span class="green">>1.2.3</span>",</span>
    <span class=fragment>"express": "<span class="green">>=1.2.3</span>",</span>
    <span class=fragment>"express": "<span class="green">~1.2.3</span>", // >=1.2.3 <1.3.0</span>
    <span class=fragment>"express": "<span class="green">^1.2.3</span>", // >=1.2.3 <2.0.0</span>
    <span class=fragment>"express": "<span class="green">1.2.x</span>", </span>
    <span class=fragment>"express": "<span class="green">latest</span>",</span>
    <span class=fragment>"express": "<span class="green">git://github.com/expressjs/express.git</span>",</span>
    <span class=fragment>"express": "<span class="green">git://github.com/expressjs/express.git#4.13.4</span>",</span>
    <span class=fragment>"express": "<span class="green">git://github.com/expressjs/express.git#master</span>",</span>
    <span class=fragment>"express": "<span class="green">git://github.com/expressjs/express.git#f3d99a4</span>",</span>
    <span class=fragment>"express": "<span class="green">expressjs/express#f3d99a4</span>"</span>
  }
}</pre>
    <a class="fragment" href="https://docs.npmjs.com/misc/semver#advanced-range-syntax">Advanced Range Syntax</a>
</section>

<section>
    <h4>npm</h4>
    <p class="cons left fragment">Дубликаты</p>
    <p class="cons left fragment">Windows API имеет <a href="https://msdn.microsoft.com/ru-ru/library/windows/desktop/aa365247(v=vs.85).aspx#maxpath">ограничение на длину</a> абсолютного пути к файлу</p> <!-- 260 (or 32767 for unicode api)-->
</section>

<section>
    <h4>npm <span class="green">vs</span> npm3</h4>
    <img src="img/npm3vs2-01.png" class=invert>
</section>

<section>
    <h4>npm <span class="green">vs</span> npm3</h4>
    <img src="img/npm3vs2-02.png" class=invert>
</section>

<section>
    <h4>npm3</h4>
    <img src="img/npm3vs2-05.png" class=invert>
</section>

<section>
    <h4>npm3</h4>
    <img src="img/npm3vs2-03.png" class=invert>
</section>

<section>
    <h4>npm <span class=green>dedupe</span> <span class=grey>(deduplicate)</span></h4>
    <p class="fragment">Упрощает структуру зависимостей,<br> делая её максимально плоской<br> и устраняя дублирование</p>
</section>

<section>
    <img src="img/npm3vs2-04.png" class=invert>
</section>

<section>
    <h4>npm <span class=green>outdated</span></h4>
    <p class="fragment">Находит устаревшие зависимости</p>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>outdated</span> <span class=magenta>--depth=1</span>
    </pre>
    <pre class="fragment">
Package                 Current  Wanted  Latest  Location
<span class=red>mocha</span>                     2.3.3   <span class=green>2.3.3</span>   <span class=magenta>2.4.5</span>  <span class=grey>mocha</span>
<span class=red>nodemon</span>                   1.8.0   <span class=green>1.8.0</span>   <span class=magenta>1.9.1</span>  <span class=grey>nodemon</span>
<span class=red>lodash</span>                   3.10.1  <span class=green>3.10.1</span>   <span class=magenta>4.6.1</span>  <span class=grey>lodash</span>
<span class=red>supertest</span>                 1.1.0   <span class=green>1.1.0</span>   <span class=magenta>1.2.0</span>  <span class=grey>supertest</span>
<span class=red>vow</span>                      0.4.11  <span class=green>0.4.12</span>  <span class=magenta>0.4.12</span>  <span class=grey>vow-fs > vow</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>update</span>
    </pre>
</section>

<section>
    <h4><span class="green">Установка зависимости</span></h4>
    <ol>
        <li>Поиск архива с нужной версией</li>
        <li class="fragment">Скачивание</li>
        <li class="fragment">Распаковка</li>
        <li class="fragment">Компилирование <span class="grey">(по необходимости)</span></li>
    </ol>
</section>

<section>
    <h4>npm <span class=green>cache</span></h4>
    <p class="fragment">Кеширует зависимости <br><span class="grey">(по умолчанию, автоматически)</span></p>
    <pre class="fragment">

/home/gogoleff/.npm <span class=grey>(unix)</span>
    </pre>
    <pre class="fragment">/Users/gogolеff/AppData/Local/npm-cache <span class=grey>(windows)</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>cache</span> clean
    </pre>
</section>

<section>
    <h4>.npmrc</h4>
    <pre class="fragment"><code>
save-exact=true // Default is false
    </code></pre>
    <pre class="fragment"><code>
progress=false // Hides progress (perfomance boost)
    </code></pre>
    <pre class="fragment"><code>
init-license=MIT // Sets npm init default license
    </code></pre>
    <pre class="fragment"><code>
init-author-name='Sergey Gogolev'
    </code></pre>
    <a class="fragment" href="https://docs.npmjs.com/misc/config">docs.npmjs.com/misc/config</a>
</section>

<section>
    <h4>npm <span class=green>publish</span></h4>
    <p class="fragment">Публикует пакет в репозиторий</p>
    <pre class="fragment"><code>
// package.json
{
    "name": "notes",
    "version": "1.0.0"
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>version</span> minor <span class=grey>// 1.1.0</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>publish</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>publish</span> <span class="magenta">--tag</span> beta
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> express@beta
    </pre>
</section>

<section>
    <h4>npm <span class=green>publish</span></h4>
    <pre class="fragment"><code>
// package.json
{
    "name": "notes",
    "main": "./dist/index.js"
}
    </code></pre>
    <pre class="fragment"><code>
const notes = require('notes');
    </code></pre>
</section>

<section>
    <h4><a href="#/1">Codestyle</a></h4>
</section>

<section>
    <pre><code>
let foo = 1,
    bar = 2,
    baz = 3;
    </code></pre>
    <p class="red">vs</p>
    <pre><code>
let foo = 1;
let bar = 2;
let baz = 3;
    </code></pre>
</section>

<section data-background="img/zerg-vs-terran.jpg">
    <p>spaces <span class="red">vs</span> tabs</p>
    <img src="">
</section>

<section>
    <h4>Использование let и const</h4>
    <pre><code>
const pi = 3.141592653589;
const e = 2.71828182;
const φ = 1.618033988;

for(let i = 0; i < 10; i++) {
    console.log(i);
}
    </code></pre>
</section>

<section>
    <h4>Максимальная вложенность блоков</h4>
    <pre><code>
if (user.isAuthorized) {
    if (notes.length > 0) {
        for(let i = 0; i < note.length; i++) {
            console.log(notes[i]);
        }or
    } else {
        console.log('Notes not found!')
    }
}
    </code></pre>
</section>

<section>
    <h4 style="margin-left: -120px"><span class="fragment red" data-fragment-index=1>Беc</span>полезное code review</h4>
    <pre><code data-noescape>
exports.list = function (req, res) { <span class="fragment" data-fragment-index=1>//Use arrow</span>
    let notes = Note.findAll(); <span class="fragment" data-fragment-index=1>// Use const</span>
    let data = { <span class="fragment" data-fragment-index=1>// Use const</span>
        notes: notes,
        meta: req['meta'] <span class="fragment" data-fragment-index=1>// Use dot operator</span>
    };

    res.render('notes', data);
};
    </code></pre>
</section>

<section>
    <h4>Codestyle помогает</h4>
    <p class="left fragment pros">Ускорить восприятие кода всей команды</p>
    <p class="left fragment pros">Избежать конфликтов</p>
    <p class="left fragment pros">Избежать типичных ошибок в коде</p>
    <p class="left fragment pros">Сделать код качественнее</p>
</section>

<section>
    <h4>codestyle.md</h4>
    <pre><code class="markdown">
# Variable declaration

* Each variable should be declared:

    * using a var statement;
    * only once in the current scope;
    * on a new line;
    * as close as possible to the place
      where it's first used.

* Each var statement should have only
  one variable declared in it.
    </code></pre>
    <a class="fragment" href="https://github.com/ymaps/codestyle/blob/master/javascript.md">ymaps/codestyle</a>
</section>

<section>
    <h4>Цикломатическая сложность<span class="fragment">: <span class="green">3</span></span></h4>
    <pre><code>
function getNotes() {
    if (user.isAuthorized) {
        return null;        // Первый путь
    }

    if (notes.length) {
        return notes;       // Второй путь
    } else {
        return null;        // Третий путь
    }
}
    </code></pre>
</section>

<section>
    <img src="img/editorconfig.png">
</section>

<section>
    <h4>.editorconfig</h4>
    <pre>
app/
<span class="grey">└──</span> app.js
<span class="red"><span class="grey">└──</span> .editorconfig</span>
    </pre>
    <pre><code>
[*]
indent_size = 4
indent_style = space
insert_final_newline = true

[*.json]
indent_size = 2
    </code></pre>
    <a class="fragment" href="http://editorconfig.org/">editorconfig.org</a>
</section>

<section>
    <p class="fragment"><a href="http://jshint.com/"><img src="img/jshint.png" width=200></a></p>
    <p class="fragment"><a href="http://jscs.info/"><img src="img/jscs.svg" width=200></a></p>
    <p class="fragment"><a href="http://eslint.org/"><img src="img/eslint.png" width=200></a></p>
    <a class="fragment" href="https://habrahabr.ru/post/220229/">habrahabr.ru/post/220229/</a>
</section>

<section>
    <h4>eslint</h4>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> <span class=magenta>--save-dev</span> eslint
    </pre>
    <pre class="fragment">
app/
<span class="grey">└──</span> app.js
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> models
<span class="grey">└──</span> controllers
<span class="grey">└──</span> views
<span class="grey">└──</span> public
<span class="red"><span class="grey">└──</span> .eslintrc.json</span>
    </pre>
</section>

<section>
    <h4>.eslintrc.json</h4>
    <pre><code>
{
    "parserOptions": {
        "ecmaVersion": 6
    },
    "env": {
        "browser": true,
        "node": true
    },
    "rules": {
        "dot-notation": 2,
        "no-unused-vars": 1,
        "no-empty": 2,
        "max-len": [2, 100],
        "max-params": [2, 3],
    }
}
    </code></pre>
</section>

<section>
    <h4>.eslintrc.json</h4>
    <pre><code>
{
    "rules": {
        "dot-notation": 2,
        "no-unused-vars": 1,
        "max-len": [2, 100],
        "max-params": [2, 3],
    }
}
    </code></pre>
    <pre>

<span style="color:cyan">0</span> - <span style="color:grey">off</span>

<span style="color:cyan">1</span> - <span style="color:orange">warn</span>

<span style="color:cyan">2</span> - <span style="color:red">error</span></pre>
    <a class="fragment" href="http://eslint.org/docs/rules/">eslint.org/docs/rules</a>
</section>

<section>
    <h4>.eslintrc.json</h4>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>install</span> <span class=magenta>--save-dev</span> eslint-config-xo
    </pre>
    <pre class="fragment"><code>
{
    "extends": "xo",
    "rules": {
        "max-len": [2, 79],
        "max-params": [2, 3],
    }
}
    </code></pre>
    <a class="fragment" href="https://www.npmjs.com/search?q=eslint-config">npmjs.com/search?q=eslint-config</a>
</section>

<section>
    <h4>.eslintignore</h4>
    <pre class="fragment">
app/
<span class="grey">└──</span> app.js
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> .eslintrc.json
<span class="red"><span class="grey">└──</span> .eslintignore</span>
    </pre>
    <pre class="fragment"><code data-noescape>
build/
**/*.coffee.js
<del>node_modules</del>
    </code></pre>

    <pre class="fragment"><code data-noescape>
/* eslint no-unused-vars: 0 */
/* eslint max-params: [2, 4] */
function onError(err, req, res, next) {
    res.sendStatus(500);
}
    </code></pre>
</section>

<section>
    <h4>eslint</h4>
    <pre class="fragment"><span class=grey>$</span> node_modules/.bin/eslint
    </pre>
    <img class="fragment" src="img/eslint-output.png">
</section>

<section>
    <h4>eslint <span class=red>♡</span> atom</h4>
    <img src="img/eslint-atom.png">
</section>

<section>
    <pre><span class=grey>$</span> node_modules/.bin/eslint <span class=magenta>--fix</span>
    </pre>
</section>

<section>
    <h4>Abstract syntax tree</h4>
    <pre><code data-noescape>
let pi = 3.14
    </code></pre>
    <img src="img/ast.svg" width=400>
</section>

<section>
    <pre><code>{
  "type": "Program",
  "body": [
    {
      "type": "VariableDeclaration",
      "declarations": [{
          "type": "VariableDeclarator",
          "id": {
            "type": "Identifier",
            "name": "pi"
          },
          "init": {
            "type": "Literal",
            "value": 3.14,
          }
      }],
      "kind": "let"
    }
  ]
}</code></pre>
</section>

<section>
    <h4>Abstract syntax tree</h4>
    <a href="https://astexplorer.net/">astexplorer.net</a>
    <a href="http://jointjs.com/demos/javascript-ast">jointjs.com/demos/javascript-ast</a>
</section>

<section>
    <p class="fragment"><a href="http://csslint.net/"><img src="img/csslint.png" width=200></a></p>
    <p class="fragment"><a href="http://csscomb.com/">CSScomb</a></p>
    <p class="fragment"><a href="http://stylelint.io/"><img src="img/stylelint.png" width=200></a></p>
</section>

<section>
    <h4>CSScomb</h4>
    <p class="cons left fragment">Немного правил</p>
    <p class="pros left fragment">Автоматическое исправление ошибок</p>
    <p class="pros left fragment">Автоматическая группировка свойств</p>
    <pre><code class="css fragment">
.tooltip {
    position: absolute;

    width: 200px;
    height: 40px;

    font-size: 16px;
}
    </code></pre>
</section>

<section>
    <h4>Stylelint</h4>
    <p class="cons left fragment">Нет автоматического исправления ошибок</p>
    <p class="pros left fragment">Более <a href="http://stylelint.io/user-guide/rules/">100 правил</a></p>
    <p class="pros left fragment">Пресеты</p>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>install</span> <span class=magenta>--save-dev</span> stylelint stylelint-config-standard
    </pre>
    <a class="fragment" href="https://www.npmjs.com/search?q=stylelint-config">npmjs.com/search?q=stylelint-config</a>
</section>

<section>
    <h4><a href="#/1">Scripts</a></h4>
</section>

<section>
    <h4><span class="green">Задачи</span></h4>
    <ul>
        <li class="fragment left">Запуск dev сервера</li>
        <li class="fragment left">Сборка статики (js, css)</li>
        <li class="fragment left">Запуск тестов</li>
        <li class="fragment left">Проверка codestyle</li>
    </ul>
</section>

<section>
    <h4><span class="green">Цель</span></h4>
    <p>Запуск комплексных команд в виде простых запоминающихся алиасов к ним</p>
</section>

<section>
    <h4><span class="green">Инструменты</span></h4>
    <div class="fragment left"><center>Gulp</center>
    <pre><code>
const gulp = require('gulp');
const jshint = require('gulp-jshint');

gulp.task('lint', () => {
    gulp
        .src('*.js')
        .pipe(jshint())
});
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> gulp <span class=green>lint</span>
    </pre>
    </div>
</section>

<section>
    <h4><span class="green">Инструменты</span></h4>
    <div class="fragment left"><center>Makefile</center><pre><code class="makefile" data-noescape>
<span class="green">lint:</span>
    node_modules/.bin/stylelint **/*.css
    node_modules/.bin/eslint .

<span class="green">test:</span> lint
    node_modules/.bin/mocha test/
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> make <span class=green>test</span>
    </pre>
    </p>
</section>

<section>
    <h4><span class="green">Инструменты</span></h4>
    <div class="fragment left"><center>npm scripts</center><pre><code>
{
  "name": "notes",
  "scripts": {
    "test": "node_modules/.bin/mocha test/",
    "lint:js": "node_modules/.bin/eslint ."
  }
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm run <span class=green>test</span>
    </pre>
    </div>
</section>

<section>
    <h4>.bin</h4>
    <pre class="fragment"><code>
{
  "name": "mocha",
  "bin": {
      "mocha": "./path/to/index.js",
  }
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm install <span class=green>mocha</span>
    </pre>
    <pre class="fragment">node_modules/.bin/mocha <span class=grey>-></span> ../mocha/path/to/index.js
    </pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <pre class="fragment"><code data-noescape>
{
  "name": "notes",
  "scripts": {
    <del>"test": "node_modules/.bin/mocha test/"</del>
    "test": "mocha test/"
  }
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> mocha
    </pre>
    <pre class="fragment"><span class=grey>$</span> echo <span class=magenta>$PATH</span>
    </pre>
    <pre class="fragment">
/Users/gogoleff/bin<span class=red>:</span>/usr/local/bin<span class=red>:</span>/usr/local/bin<span class=red>:</span>/usr/bin<span class=red>:</span>/bin</pre>
    <p class="fragment">npm добавляет <span class="green">node_modules/.bin/</span> в <span class="magenta">PATH</p>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Scripts shortcuts</p>

    <pre class="fragment"><del><span class=grey>
$</span> npm run <span class=green>test</span></del>
<span class=grey>$</span> npm <span class=green>test</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>start</span>
    </pre>
    <pre class="fragment"><span class=grey>$</span> npm <span class=green>stop</span>
    </pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Console commands</p>

    <pre class="fragment"><code data-noescape>
"scripts": {
  "clean": "rm -rf node_modules/"
}
    </code></pre>

    <p class="fragment red">Помним о мультиплатформе</p>

    <pre class="fragment"><code data-noescape>
"scripts": {
  "clean": "rimraf node_modules/"
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>install</span> rimraf</span>
    </pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Series commands</p>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "check:lint": "eslint .",
  "check:test": "mocha test/"
  "check": "npm run lint <span class="fragment highlight init_visible">&&</span> npm run mocha"
}
    </code></pre>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "build": "<span class="fragment highlight init_visible">npm-run-all</span> check:lint check:test"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Parallel commands</p>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "lint:css": "stylelint **/*.css",
  "lint:js": "eslint .",
  "lint": "npm run lint:css <span class="fragment highlight init_visible">&</span> npm run lint:js"
}
    </code></pre>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "lint": "<span class="fragment highlight init_visible">npm-run-all --parallel</span> lint:css lint:js"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Streams</p>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "css:pre": "stylus main.styl <span class="fragment highlight init_visible">></span> main.css",
  "css:post": "autoprefixer -b <span class="fragment highlight init_visible"><</span> main.css <span class="fragment highlight init_visible">|</span> cssmin"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Groups</p>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "lint:css": "stylelint **/*.css",
  "lint:js": "eslint .",
  "lint": "npm-run-all --parallel <span class="fragment highlight init_visible">lint:*</span>"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Configuration</p>
    <pre class="fragment"><code data-noescape>
"config": {
  "report": "nyan"
},
"scripts": {
  "test": "mocha test/ -R <span class="fragment highlight init_visible">$npm_package_config_report</span>"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p><span class="grey">External scripts</p>
    <pre class="fragment"><code>
const favicons = require('favicons');

favicons({
    source: 'public/logo.png',
    dest: 'public/'
});
    </code></pre>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "build:favicon": "node favicon.js"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Arguments</p>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "start": "node app.js",
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>run</span> start <span class="red">--</span> --mode=debug
    </pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <p class="grey">Hooks</p>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>install</span> <span class="magenta">--save-dev</span> husky
    </pre>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "precommit": "npm run test",
  "prepush": "npm run test",
  "prepublish": "npm run test"
}
    </code></pre>
</section>

<section>
    <h4><span class="green">npm scripts</span></h4>
    <!-- Kate Hudson -->
    <p><a class="fragment" href="https://www.youtube.com/watch?v=0RYETb9YVrk">Advanced front-end automation with npm</a></p>
    <!-- Keith Cirkel -->
    <p><a class="fragment" href="http://blog.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/">How to Use npm as a Build Tool</a></p>
</section>

<section>
    <h4><a href="#/1">Deploy</a></h4>
</section>

<section>
    <img src="img/classic.png">
    <p class="grey">
        FTP,
        SCP,
        rsync
    </p>
</section>

<section>
    <img src="img/classic-2.png" style="margin: 0 0 0 30px">
    <p class="red">Конфликт за ресурсы</p>
</section>

<section>
    <h4>Virtualization</h4>
    <img src="img/hypervisor.png" width=300>
    <p>Изолирование дерева процессов и ресурсов <span class="grey">(memory, cpu, disc)</span></p>
</section>

<section>
    <h4>Containers</h4>
    <img src="img/hypervisor.png" width=300>
    <img src="img/containers.png" width=300>
    <p>Не требуют OS и могут содержать только приложение</p>
</section>

<section>
    <h4>Containers</h4>
    <p class="pros left">Потребляют меньше ресурсов</p>
    <p class="pros left fragment">Управление контейнерами менее требовательно к ресурсам</p>
    <p class="pros left fragment">Быстрее запуск</p>
    <p class="cons left fragment">Изоляция <a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9357">уязвима</a></p>
    <p class="cons left fragment">Linux-only или windows-only</p>
</section>

<section>
    <h4><img src="img/docker.png"></h4>
    <p><img src="img/container.png"><img class="fragment" src="img/tools.png"></p>
    <p class="fragment left"><a href="https://hub.docker.com/">Docker Hub</a> – хранилище контейнеров</p>
    <p class="fragment left"><a href="https://www.docker.com/products/docker-toolbox">Docker Tools</a> – утилиты для сборки, публикации и запуска</p>
    <p class="fragment left"><a href="">Docker Images</a> – read-only образы</p>
</section>

<section>
    <h4><a href="">Docker Images</a></h4>
    <img src="img/ogres.gif">
</section>

<section>
    <h4><a href="">Docker Images</a></h4>
    <p><img src="img/image.png"><img class="fragment" src="img/image-2.png"></p>
    <p class="fragment">Из образов создаются экземпляры контейнеров</p>
</section>

<section>
    <h4><img src="img/heroku.png"></h4>
    <p class="grey">Облачная PaaS-платформа</p>
</section>

<section>
    <h4>Heroku</h4>
    <img src="img/heroku-routing.png">
    <p class="fragment">Контейнеры в Heroku - <span class="green">Dyno</span></p>
</section>

<section>
    <h4>Heroku</h4>
    <img src="img/image.png"><img class="fragment" src="img/image.png">
    <img class="fragment" src="img/image.png">
    <p class="fragment">Больше нагрузка - больше контейнеров</p>
</section>

<section>
    <p>Heroku</p>
    <a href="https://toolbelt.heroku.com/">toolbelt.heroku.com</a>
    <pre class="fragment"><span class=grey>
$</span> heroku<span class=green></span>
    </pre>
</section>

<section>
    <p>Heroku</p>
    <pre>
app/
<span class="grey">└──</span> app.js
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> models
<span class="grey">└──</span> controllers
<span class="grey">└──</span> views
<span class="grey">└──</span> public
<span class="red"><span class="grey">└──</span> package.json</span>
    </pre>
    <pre><code data-noescape>
"engines": {
    "node": "4.4.0"
}
    </code></pre>
</section>

<section>
    <p>Heroku</p>
    <pre>
app/
<span class="red"><span class="grey">└──</span> app.js</span>
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> models
<span class="grey">└──</span> controllers
<span class="grey">└──</span> views
<span class="grey">└──</span> public
<span class="grey">└──</span> package.json
    </pre>
    <pre><code data-noescape>
app.listen(process.env.PORT || 5000)
    </code></pre>
</section>

<section>
    <p>Heroku</p>
    <pre>
app/
<span class="grey">└──</span> app.js
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> models
<span class="grey">└──</span> controllers
<span class="grey">└──</span> views
<span class="grey">└──</span> public
<span class="grey">└──</span> package.json
<span class="red fragment"><span class="grey">└──</span> Procfile</span>
    </pre>
    <pre class="fragment"><code data-noescape>
web: node app.js
    </code></pre>
    <pre class="fragment"><code data-noescape>
&lt;process type&gt;: &lt;command&gt;
    </code></pre>
    <a class="fragment" href="https://devcenter.heroku.com/articles/procfile">Process Types and the Procfile</a>
</section>

<section>
    <p>Heroku</p>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>local</span> web
    </pre>
    <pre class="fragment">
forego | starting web.1 on port 5000
<span class=green>web.1</span>  | Listening on port 5000
<span class=green>web.1</span>  | GET / 200 35.429 ms - 410
<span class=green>web.1</span>  | GET /favicon.ico 404 2.047 ms - 9
    </pre>
    <pre class="fragment">
http://localhost:5000/
    </pre>
</section>

<section>
    <p>Heroku</p>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>login</span></pre>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>create</span> urfu2015-notes
    </pre>
    <pre class="fragment">
Creating urfu2015-notes... done, stack is cedar-14
<span class="green">https://urfu2015-notes.herokuapp.com/</span> | <span class="grey">https://git.heroku.com/urfu2015-notes.git</span>
    </pre>
</section>

<section>
    <p>Heroku</p>
    <pre><span class=grey>
$</span> git <span class=green>push</span> heroku master</pre>
    <pre class="fragment">
<span class=grey>remote:</span> Compressing source files... done.
<span class=grey>remote:</span> Building source:
<span class=grey>remote:</span>
<span class=grey>remote:</span> -----> Using set buildpack heroku/nodejs
<span class=grey>remote:</span> -----> Node.js app detected
<span class=grey>remote:</span>
<span class=grey>remote:</span> -----> Creating runtime environment
<span class=grey>remote:</span>
<span class=grey>remote:</span>        NODE_ENV=production
<span class=grey>remote:</span>        NODE_MODULES_CACHE=true
<span class=grey>remote:</span>
<span class=grey>remote:</span> -----> Installing binaries
<span class=grey>remote:</span>        engines.node (package.json):  4.4.0    </pre>
    <a class="fragment" href="https://urfu2015-notes.herokuapp.com/">urfu2015-notes.herokuapp.com</a>
</section>

<section>
    <p>Heroku</p>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>logs</span> </pre>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>ps:scale</span>

web=1:Free
    </pre>
    <pre class="fragment"><span class=grey>
$</span> heroku <span class=green>ps:scale</span> web=2

Scaling dynos... failed
 !    Cannot update to more than 1 Free size dynos per process type.
    </pre>
</section>

<section>
    <p><a href="http://patg.net/containers,virtualization,docker/2014/06/05/docker-intro/">Docker: Containers for the Masses</a></p>
    <p><a href="https://devcenter.heroku.com/categories/heroku-architecture">Heroku Architecture</a></p>
    <p><a href="https://habrahabr.ru/post/253877/">Понимая Docker</a></p>
</section>

<section>
    <h4><a href="#/1">CDN</a></h4>
</section>

<section>
    <h4><span class="green">Статика</span></h4>
    <p class="fragment">Не зависит от состояния приложения</p> <!-- authorization for example -->
    <p class="fragment">Не меняется в рамках одной версии</p>
    <p class="fragment">Требует в основном сетевые ресурсы</p>
    <pre class="fragment" style="margin-left: 350px !important">
app/
<span class="grey">└──</span> app.js
<span class="grey">└──</span> routes.js
<span class="grey">└──</span> models
<span class="grey">└──</span> controllers
<span class="grey">└──</span> views
<span class="red"><span class="grey">└──</span> public
    <span class="grey">└──</span> index.css
    <span class="grey">└──</span> index.js</span>
    </pre>
</section>

<section>
    <h4><span class="green">Задача</span></h4>
    <p>Разместить <span class="magenta">статику</span> ближе к пользователю</p>
</section>

<section>
    <h4>Content Delivery Network</h4>
    <p class="grey">Географически распределённая сетевая инфраструктура</p>
</section>

<section>
    <h4>Content Delivery Network</h4>
    <img src="img/cdn-wo.png"><img src="img/cdn.png" style="margin: 0 0 0 30px;">
</section>

<section>
    <div style="float: left;">
        <h4 class="green">Unicast</h4>
        <p>One Machine, One IP</p>
        <img src="img/unicast.gif" class="invert" width=300>
    </div>
    <div class="fragment" style="float: right;">
        <h4 class="green">Anycast</h4>
        <p>Many Machines, One IP</p>
        <img src="img/anycast.gif" class="invert" width=300>
        <p class="fragment grey">BGP</p>
    </div>
</section>

<section>
    <h4>Border Gateway Protocol</h4>
    <img src="img/bgp.png" width=700>
</section>

<section>
    <h4>Задачи</h4>
    <p class="pros left">Размещение статики ближе к пользователю</p>
    <p class="pros left fragment">Кеширование</p>
    <p class="pros left fragment">Сжатие текстовой статики <span class="green">(gzip)</span>:<br> <span class="grey">html, css, js, json, ...</span></p>
    <p class="pros left fragment">Обеспечение <span class="green">100%</span> доступности</p>
</section>

<section>
    <p><img src="img/cloudfare.png" width=300></p>
    <p><img src="img/maxcdn.png" width=200></p>
    <p><img src="img/surge.png" width=300></p>
</section>

<section>
    <h4>Выбираем</h4>
    <p class="question left">Количество точек присутствия<br> <span class="grey">Point of Presence</span></p>
    <p class="question left fragment">Политика кеширования</p>
    <p class="question left fragment">Политика устаревания</p>
    <p class="question left fragment">API</p>
</section>

<section>
    <h4>Surge</h4>
    <pre><span class=grey>
$</span> npm <span class=green>install</span> <span class="magenta">--save-dev</span> surge
    </pre>
    <pre class="fragment"><code data-noescape>
"scripts": {
  "deploy:static": "surge -p ./public"
}
    </code></pre>
    <pre class="fragment"><span class=grey>
$</span> npm <span class=green>run</span> deploy:static
    </pre>
</section>

<section>
    <h4>Surge</h4>
    <img src="img/surge-welcome.png" width=100%>
</section>

<section>
    <h4>Surge</h4>
    <pre><code data-noescape>
"scripts": {
  "deploy:static": "surge -p ./public -d urfu2015..."
}
    </code></pre>
</section>

<section>
    <pre><code class="html" data-noescape style="font-size: .8em !important;">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;{{ title }}&lt;/title&gt;
    <del>&lt;link rel="stylesheet" href="/index.css"&gt;</del>
    &lt;link rel="stylesheet"
        href="http://urfu2015-notes.surge.sh/index.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    {{{ body }}}
    <del>&lt;script src="/index.js"&gt;&lt;/script&gt;</del>
    &lt;script src="http://urfu2015-notes.surge.sh/index.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
    </code></pre>
</section>

<section>
    <h4>Обновить кеш у пользователя</h4>
    <div class="fragment"><p class="grey">Response</p>
    <pre><code data-noescape>
<span class="grey">HTTP/1.1</span> <span class="green">200</span> OK <!--Status line-->
<span class="fragment highlight init_visible"><span class="magenta">Cache-Control:</span> public, max-age=31536000, no-cache</span><!-- Headers -->
<span class="magenta">Content-Type:</span> text/css; charset=UTF-8
<span class="fragment highlight init_visible"><span class="magenta">ETag:</span> d1d3c5c4cdb2568785ba1a366b7fb048</span>
<span class="magenta">Server:</span> SurgeCDN/0.12.2
<!-- Message body -->
body {
    font-family: Arial, sans-serif;
}
    </code></pre></div>
</section>

<section>
    <h4>Обновить кеш у пользователя</h4>
    <p class="grey">Request</p>
    <pre><code data-noescape>
<span class="green">GET</span> /index.css <span class="grey">HTTP/1.1</span>
<span class="magenta">Host:</span> urfu2015-notes.surge.sh
<span class="fragment highlight init_visible"><span class="magenta">If-None-Match:</span> d1d3c5c4cdb2568785ba1a366b7fb048</span>
    </code></pre>
    <p class="fragment"><span class="magenta">ETag</span> === <span class="magenta">If-None-Match</span></p>
    <div class="fragment"><p class="grey">Response</p>
    <pre><code data-noescape>
<span class="grey">HTTP/1.1</span> <span class="green">304</span> Not Modified
    </code></pre></div>
</section>

<section>
    <h4>Content Delivery Network</h4>
    <p><a href="https://habrahabr.ru/company/webzilla/blog/236511/">Знакомство с Content Delivery Network</a></p>
    <p><a href="http://www.slashroot.in/what-anycast-and-how-it-works">What is Anycast and How it works</a></p>
    <p><a href="http://www.amazon.com/Content-Delivery-Networks-Electrical-Engineering/dp/3540778861">Content Delivery Networks</a></p>
</section>

<section>
    <h4><a href="#/1">Automate</a></h4>
</section>

<section>
    <h4 class="green">Continuous Integration</h4>
    <p>Автоматизированная сборка и тестирование исходного кода по факту изменения</p>
</section>

<section>
    <h4 class="green">Continuous Deployment</h4>
    <p>Автоматизированный деплой приложения</p>
</section>

<section>
    <h4>Continuous Integration</h4>
    <img src="img/ci.png">
</section>

<section>
    <h4><span class="green">Polling</span> vs <span class="green">hooks</span></h4>
</section>

<section>
    <h4>Continuous Integration</h4>
    <p class="pros left">Автоматизация рутины</p>
    <p class="pros left fragment">Неизбежное тестирование кода</p>
    <p class="pros left fragment">Быстрая доставка до конечного пользователя</p>
</section>

<section>
    <h4>Сервисы</h4>
    <p class="fragment"><a href="https://www.jetbrains.com/teamcity/"><img src="img/tc.png" width=200></a></p>
    <p class="fragment"><a href="https://drone.io/"><img src="img/drone.png" width=200></a></p>
    <p class="fragment"><a href="https://travis-ci.org/"><img src="img/travis.png" width=150></a></p>
</section>

<section>
    <h4>.travis.yml</h4>
    <pre><code class="yaml">
language: node_js
node_js:
  - "4"
install:
  - npm install
script:
  - npm run lint
  - npm test
    </code></pre>
</section>

<section>
    <h4>.travis.yml</h4>
    <pre><code class="yaml">
after_success:
  - '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && \
    npm run deploy:static'
    </code></pre>
</section>

<section>
    <h4>.travis.yml</h4>
    <pre><code class="yaml">
deploy:
  skip_cleanup: true
  provider: heroku
  api_key:
    secure: "RYtDTxQ+oCsAc5KTR+YtpdHWHlN7Ml+PWHsPul3Wdho6an8pvXhfTdMcg3sxncTji8DyOinEJQVYxaX61dw/dtd1fF7n06WWeFiXjlXAAp+17ySauWkwbFFicylrylYAl6nnC6Rw/T2FJ7Z3w4QQR377j8cgY5Ra9h3mSi7sT12xkfBYgjtyDDrajTASB5ZA3Hn9J9nRlg5Q52LIGMnGWkad+qF6MJfo5kja04YgrlAyqnPKVoxsL7k0fG0ZBjvg971DOBrxf2kt89hP7PWoXB4oOm3aNHBg7GFbyIF9qOspNcEIECjFLFaARIA556seK4zZe523HjvfSrf6QbCXsRkFEiY+zEOzUtE4KrfP9Igu+hZ9IVcLeDu2jrDnpJHRtMgFvgSbdmHExdzTbMDEBrZjfCC6N+5FjbD9HuGjW35bQ+UtneSP+dZI2xdGsFZhrlhym/zrij2DcAh9d9XS0EdIZTr0QFwg6PvyKW1EMX1zpOl02i4suVSw/Bw+C+usG3qaSOdDLvnYAYe0dKWK7wYLHxVG/6yUaN1BV8BF8mxmKqEuXRfiOnBNrPvWIJDmEZ8SOs2tlsDAK+1iTME+R2U/ivwERWP7DuJ8lOWqwCLQTtRx73CBmzWq6RvoBOZJR0BV2rCrMvZyFX6KnDj4Df5PyvfWez3lcSt2P7GjYuk="
  on: master
  app: urfu2015-notes
    </code></pre>
    <pre class="fragment"><code data-noescape><span class=grey>
$</span> travis <span class=green>encrypt</span> $(heroku auth:token)
    </code></pre>
    <a class="fragment" href="https://travis-ci.org">travis-ci.org</a>
</section>

<section>
    <h3>Структура проекта</h3>
</section>

<section>
    <pre>
notes
    <span class="fragment">├── .gitignore</span>
    <span class="fragment">├── .editorconfig</span>
    <span class="fragment">├── package.json</span>
    <span class="fragment">├── README.md</span>
    <span class="fragment">└── index.js</span>
    </pre>
</section>

<section>
       <h4>Сервис «Заметки»</h4>
       <p class="grey">Храним заметки пользователя в виде файлов</p>
       <pre>
   <span class="green"> GET</span> /                   <span class="grey textbook">главная</span>
       </pre>
       <pre>
   <span class="green"> GET</span> /notes              <span class="grey textbook">список заметок</span>
       </pre>
       <pre>
   <span class="green">POST</span> /notes              <span class="grey textbook">добавление заметки</span>
       </pre>
       <pre>
   <span class="green"> GET</span> /notestodo-list    <span class="grey textbook">просмотр заметки</span>
       </pre>
</section>

<section>
    <h4><span class="grey">MVC</span>. Model</h4>
    <pre>
<span class="grey">notes</span>
    <span class="grey">├── .gitignore</span>
    <span class="grey">├── .editorconfig</span>
    <span class="grey">├── package.json</span>
    <span class="grey">├── README.md</span>
    <span class="grey">├── index.js</span>
    └─┬ models
      └── note.js
</section>

<section>
    <h4><span class="grey">MVC</span>. View</h4>
    <pre>
<span class="grey">notes</span>
    <span class="grey">├── .gitignore</span>
    <span class="grey">├── .editorconfig</span>
    <span class="grey">├── package.json</span>
    <span class="grey">├── README.md</span>
    <span class="grey">├── index.js</span>
    <span class="grey">├── models</span>
    └─┬ views
      ├── main.hbs
      ├── note.hbs
      └── notes.hbs
    </pre>
</section>

<section>
    <h4><span class="grey">MVC</span>. Controller</h4>
    <pre>
<span class="grey">notes</span>
    <span class="grey">├── .gitignore</span>
    <span class="grey">├── .editorconfig</span>
    <span class="grey">├── package.json</span>
    <span class="grey">├── README.md</span>
    <span class="grey">├── index.js</span>
    <span class="grey">├── models</span>
    <span class="grey">├── views</span>
    └─┬ controllers
      ├── notes.js
      └── pages.js
    </pre>
</section>

<section>
    <h4>Компонентный подход</h4>
</section>

<section>
    <pre>
<span class="grey">notes</span>
    <span class="grey">├── .gitignore</span>
    <span class="grey">├── .editorconfig</span>
    <span class="grey">├── package.json</span>
    <span class="grey">├── README.md</span>
    <span class="grey">├── index.js</span>
    <span class="grey">├── models</span>
    <span class="grey">├── views</span>
    <span class="grey">├── controllers</span>
    └─┬ blocks
      ├─┬ footer
      │ ├── footer.css
      │ └── footer.hbs
      ├─┬ header
      │ ├── header.css
      │ ├── header.js
      │ └── header.hbs
      └─┬ notes
        ├── notes.css
        ├── notes.js
        └── notes.hbs</pre>
</section>

<section>
    <h4>Компонентный подход</h4>
    <p class="pros left">Меньше вероятность конфликтов</p>
    <p class="pros left">Легкое переиспользование кода</p>
</section>

<section>
    <h4><span class="grey">Компонентный подход</span>. Ресурсы</h4>
    <pre>
    └─┬ blocks
      ├─┬ footer
      │ ├── <mark>footer.css</mark>
      │ └── footer.hbs
      ├─┬ header
      │ ├── <mark>header.css</mark>
      │ ├── <mark>header.js</mark>
      │ └── header.hbs
      └─┬ notes
        ├── <mark>notes.css</mark>
        ├── <mark>notes.js</mark>
        └── notes.hbs</pre>
</section>

<section>
    <h4>Публичная папка</h4>

    <pre class="size-S">
    public
    ├── footer.css
    ├── header.css
    ├── notes.css
    ├── header.js
    └── notes.js</pre>
</section>

<section>
    <h4><span class="grey">Компонентный подход</span>. Подключение</h4>

    <pre class="size-M"><code class="hljs html" data-trim>
&lt;head&gt;
    &lt;link href="/footer.css" rel="stylesheet"&gt;
    &lt;link href="/header.css" rel="stylesheet"&gt;
    &lt;link href="/notes.css" rel="stylesheet"&gt;

    &lt;script src="/header.js"&gt;&lt;/script&gt;
    &lt;script src="/notes.js"&gt;&lt;/script&gt;
&lt;/head&gt;</code></pre>
</section>

<section>
    <p class="pros left">Работает</p>
    <p class="cons left fragment">Много запросов за ресурсами</p>
    <p class="cons left fragment">Много копирований при сборке</p>
    <p class="cons left fragment">Ограничение на количество подключаемых ресурсов</p>
</section>

<section>
    <h3><a href="https://webpack.github.io/">webpack</a></h3>

    <pre class="fragment"><code class="hljs size-M" data-trim>
        npm install --save-dev webpack
    </code></pre>
</section>

<section>
    <section>
        <h2>Сборка скриптов</h2>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
{
    context: __dirname + "/blocks",
    entry: "blocks/mainPage.js",
    output: {
        path: __dirname + "/public",
        filename: "mainPage.bundle.js"
    }
}
        </code></pre>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ blocks
      └── mainPage.js</pre>

        <pre class="fragment"><code class="hljs javascript size-XS" data-trim>
var header = require('./header/header.js');
var notes = require('./notes/notes.js');

header.init();
notes.init();
        </code></pre>
    </section>

    <section>
        <h3>Запуск</h3>
<pre class="size-S">notes
    └── package.json</pre>


        <pre class="fragment"><code class="hljs javascript size-S" data-trim>
"scripts": {
    "build": "webpack"
}
        </code></pre>

        <pre class="fragment"><code class="hljs size-S" data-trim>
npm run build
        </code></pre>
    </section>

    <section>
        <pre class="size-S">notes
    └─┬ public
      ├── footer.css
      ├── header.css
      ├── notes.css
      └── <mark>mainPage.bundle.js</mark></pre>
    </section>

    <section>
        <h4>Подключение</h4>

        <pre class="size-M"><code class="hljs html" data-trim data-noescape>
&lt;head&gt;
    &lt;link href="/footer.css" rel="stylesheet"&gt;
    &lt;link href="/header.css" rel="stylesheet"&gt;
    &lt;link href="/notes.css" rel="stylesheet"&gt;

    &lt;script src="/<mark>mainPage.bundle.js</mark>"&gt;&lt;/script&gt;
&lt;/head&gt;</code></pre>
    </section>
</section>

<section>
    <section>
        <h3>Сборка стилей</h3>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ blocks
      └── mainPage.css</pre>

        <pre class="fragment"><code class="hljs size-M" data-trim data-noescape>
@import header/header.css
@import notes/notes.css
@import footer/footer.css
        </code></pre>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ blocks
      ├── <span class="grey">mainPage.css</span>
      └── mainPage.js</pre>
        <h4></h4>

        <pre class="fragment"><code class="hljs javascript size-M" data-trim data-noescape>
require('./mainPage.css');
        </code></pre>
    </section>

    <section>
        <pre><code class="hljs size-M" data-trim data-noescape>
npm run build
        </code></pre>

        <pre class="fragment red"><span class="size-M" data-trim>
You may need an appropriate
loader to handle this file type.
        </span></pre>
    </section>

    <section>
        <h4>Лоадеры</h4>

        <pre>
            <code class="size-S">npm install style-loader --save-dev</code>
            <code class="size-S">npm install css-loader --save-dev</code>
        </pre>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
{
   ...

   module: {
      loaders: [
         {test: /\.css$/, loaders: ["style", "css"]}
      ]
   }
}
        </code></pre>
    </section>

    <section>
        <pre class="size-M"><code class="hljs html" data-trim data-noescape>
&lt;head&gt;
    &lt;style type="text/css"&gt;
        body {
            font-family: Arial, sans-serif;
        }
    &lt;/style&gt;

    &lt;style type="text/css"&gt;
        header {
            border-bottom: 1px solid #ccc;
        }
    &lt;/style&gt;
&lt;/head&gt;</code></pre>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
var ExtractTextPlugin =
    require('extract-text-webpack-plugin');

module.exports = {
    ...

    plugins: [
        new ExtractTextPlugin("bundle.css")
    ]
}
        </code></pre>
    </section>


    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
module: {
    loaders: [
        {
            test: /\.css$/,
            loader: ExtractTextPlugin
             .extract('style-loader', 'css-loader')
        }
    ]
}
        </code></pre>
    </section>

    <section>
        <pre class="size-S">notes
    └─┬ public
      ├── bundle.css
      └── mainPage.bundle.js</pre>
    </section>

    <section>
        <h4>Подключение</h4>

        <pre><code class="hljs html size-XS" data-trim data-noescape>
&lt;head&gt;
    &lt;link href="/bundle.css" rel="stylesheet"&gt;

    &lt;script src="/mainPage.bundle.js"&gt;&lt;/script&gt;
&lt;/head&gt;</code></pre>
    </section>
</section>

<section>
    <section>
        <h3>Сборка картинок</h3>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        ├── notes.css
        ├── notes.js
        ├── <mark>background.png</mark>
        └── notes.hbs</pre>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS fragment">
.notes {
    background: url(background.png)
}
</code></pre>
    </section>

    <section>
        <h4>Лоадеры</h4>

        <pre>
            <code class="size-S">npm install file-loader --save-dev</code>
        </pre>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
module: {
    loaders: [
        {
            test: /(\.png|\.jpg)$/,
            loader: "file-loader"
        }
    ]
}
        </code></pre>
    </section>

    <section>
        <pre class="size-S">notes
    └─┬ public
      ├── bundle.css
      ├── mainPage.bundle.js
      └── <mark>9d86ab26bc61bc94bf09d352edff07a1.png</mark></pre>
    </section>
</section>

<section>
    <section>
        Постпроцессинг CSS
    </section>

    <section>
        <p class="pros left">расстановка браузерных префиксов</p>
        <p class="pros left fragment">линтинг</p>
        <p class="pros left fragment">конвертация картинок в base64 код</p>
        <p class="left fragment">...</p>
    </section>

    <section>
        <h4>расстановка браузерных префиксов</h4>

<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS fragment" data-trim>
.notes {
    display: flex;
}
</code></pre>
    </section>

    <section>
        <h3><a href="https://github.com/postcss/postcss">postcss</a></h3>
        <pre><code class="size-M">npm i --save-dev postcss-loader</code></pre>
    </section>

    <section>
        <h3>autoprefixer</h3>
        <pre><code class="size-M">npm i --save-dev autoprefixer</code></pre>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
var autoprefixer = require('autoprefixer');

module.exports = {
    ...

    postcss: function () {
        return [autoprefixer];
    }
}
        </code></pre>
    </section>

    <section>
<pre class="size-S">notes
└── webpack.config.js</pre>

    <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
module: {
  loaders: [
    ...

    {
      test: /\.css$/,
      loader: ExtractTextPlugin.extract(
        "style-loader",
        "css-loader"
      )
}
    </code></pre>
    </section>

    <section>
        <h4 class="red">До</h4>
        <pre><code class="hljs css size-XS" data-trim>
.notes {
    display: flex;
}
        </code></pre>

        <h4 class="fragment green">После</h4>
        <pre><code class="hljs css size-XS fragment" data-trim>
.notes {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
}
        </code></pre>
    </section>
</section>

<section>
    <section>
        <h3>Минификация CSS</h3>
    </section>

    <section data-transition="none">
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS fragment" data-trim>
.notes {
    div { margin: 0 0 0 0; }
    div {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
}
</code></pre>
    </section>

    <section data-transition="none">
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS" data-trim data-noescape>
.notes {
    div { margin: 0 0 0 0<mark>;</mark> }
    div {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex<mark>;</mark>
    }
}
</code></pre>
    </section>

    <section data-transition="none">
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS" data-trim data-noescape>
.notes {
    <mark>div {</mark> margin: 0 0 0 0; }
    <mark>div {</mark>
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
}
</code></pre>
    </section>

    <section data-transition="none">
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS" data-trim data-noescape>
.notes {
    div { margin: <mark>0 0 0 0</mark>; }
    div {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
}
</code></pre>
    </section>


    <section data-transition="none">
<pre class="size-S">notes
    └─┬ blocks
      └─┬ notes
        └── notes.css</pre>

<pre><code class="hljs css size-XS" data-trim data-noescape>
.notes {
    div { margin: 0 0 0 0; }
    div {<mark>
        </mark>display: -webkit-box;<mark>
        </mark>display: -webkit-flex;<mark>
        </mark>display: -ms-flexbox;<mark>
        </mark>display: flex;
    }
}
</code></pre>
    </section>

    <section>
        <h3>cssnano</h3>
        <pre><code class="size-M">npm i --save-dev cssnano</code></pre>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
var cssnano = require('cssnano');

module.exports = {
    ...

    postcss: function () {
        return [
            autoprefixer,
            cssnano
        ];
    }
}
        </code></pre>
    </section>

    <section>
        <h4 class="red">До</h4>
<pre><code class="hljs css size-XS" data-trim>
.notes {
    div { margin: 0 0 0 0; }
    div {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
}
</code></pre>

        <h4 class="green fragment">После</h4>
<pre><code class="hljs css size-XXS fragment" data-trim>
div{margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}
</code></pre>
    </section>
</section>

<section>
    <section>
        <h3>Минификация JS</h3>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
var webpack = require('webpack');

module.exports = {
    ...

    plugins: [
        ...
        new webpack.optimize.UglifyJsPlugin()
    ]
}
        </code></pre>
    </section>

    <section>
        <h4 class="green">После</h4>
<pre><code class="hljs jvascript size-XS" data-trim>
!function(o){function n(e){if(t[e])return t[e]. ....
</code></pre>
    </section>

    <section>
        <img src="./img/without_sourcemap.png" alt="Без sourcemap" width="146%" />
    </section>

    <section>
        <h3>sourcemap</h3>
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
module.exports = {
    ...

    devtool: 'source-map'
}
        </code></pre>

<pre class="size-S fragment">notes
    └─┬ public
      ├── mainPage.bundle.js
      └── <mark>mainPage.bundle.js.map</mark></pre>
    </section>

    <section>
<pre class="size-S">notes
    └─┬ public
      └── mainPage.bundle.js</pre>

      <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
...
//# sourceMappingURL=main.bundle.js.map
      </code></pre>
    </section>

    <section>
        <h4 class="red">До</h4>
        <img src="./img/without_sourcemap.png" alt="Без sourcemap" width="146%" />

        <h4 class="fragment green">После</h4>
        <img src="./img/with_sourcemap.png" alt="с sourcemap" width="146%" class="fragment"/>
    </section>
</section>

<section>
    <section>
        Бандлы
    </section>

    <section>
<pre class="size-S">notes
    └── webpack.config.js</pre>

        <pre class="fragment"><code class="hljs size-XS javascript" data-trim>
module.exports = {
    ...

    entry: {
        mainPage: './mainPage.js',
        innerPage: './innerPage.js'
    },</code></pre>
<pre class="fragment"><code class="hljs size-XS javascript">    output: {
        filename: "[name].bundle.js"
    }
}
        </code></pre>
    </section>
</section>


<section style="font-size: 1.2em">
    <a href="https://github.com/urfu-2015/urfu2015-notes">
        Пример сервиса «Заметки»,<br>
        подготовленного к сборке, деплою и автоматизации
    </a>
</section>

</div></div>

<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        hideAddressBar: true,
        transition: 'slide',
        dependencies: [
            {
                src: '../plugin/highlight/highlight.js',
                condition: function () {
                    return Boolean(document.querySelector('pre code'));
                },
                callback: function () {
                    hljs.configure({
                        languages: ['javascript']
                    })
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>
</body>
</html>
